<?php

namespace App\Livewire\Layouts\Customer\Header;

use Livewire\Component;
use App\Models\Category;
use Livewire\Attributes\On;

class Menus extends Component
{
    public $categories;
    public $account = false;
    public $organizedCategories = [];
    
    public function mount()
    {
        $this->loadCategories();
        $this->account = auth()->check();
    }

    protected function loadCategories()
    {
        // Get all active categories
        $allCategories = Category::where('is_active', 1)->get();
        
        // Group categories by their group_by field
        $categoryGroups = $allCategories->groupBy('group_by')->toArray();
        
        // Organize each group into left and right columns
        foreach ($categoryGroups as $groupName => $categoriesInGroup) {
            $totalCategories = count($categoriesInGroup);
            $halfCount = ceil($totalCategories / 2);
            
            $this->organizedCategories[$groupName] = [
                'name' => $groupName ?: 'Uncategorized',
                'icon' => $this->getCategoryIcon($groupName),
                'leftColumn' => array_slice($categoriesInGroup, 0, $halfCount),
                'rightColumn' => array_slice($categoriesInGroup, $halfCount)
            ];
        }
        
        // Ensure we have the full list for other components that might need it
        $this->categories = $allCategories;
    }
    
    /**
     * Get an appropriate icon based on category group name
     */
    protected function getCategoryIcon($groupName)
    {
        // Default icon SVG path
        $defaultIcon = 'M5.552 4.492c-.866.461-1.259.989-1.259 1.691 0 .528.117.739 1.345 2.441 1.38 1.914 2.031 2.908 2.619 4l.44.817-.441.443c-.57.571-1.258 1.618-1.562 2.377-.488 1.219-.553 1.833-.484 4.552.086 3.344.063 3.438-1.322 5.563-3.071 4.71-3.467 10.38-1.059 15.17 2.11 4.199 5.779 7.017 10.451 8.028 1.317.285 4.424.309 5.74.044 1.2-.242 2.463-.661 3.593-1.194l.98-.462.234.301c.71.915 3.156 2.749 4.598 3.449 1.351.656 2.078.68 5.062.167 1.944-.334 2.488-.327 4.337.057 2.919.605 3.775.501 5.844-.71 2.809-1.644 4.954-3.989 6.433-7.033 1.184-2.436 1.726-4.8 1.726-7.529 0-5.719-2.753-10.986-7.364-14.089-1.117-.752-2.25-1.345-2.748-1.438l-.344-.065.306-.339c1.465-1.622 2.695-4.262 3.013-6.47l.063-.437-.36-.03c-.345-.028-.361-.044-.389-.393l-.03-.364-.904.057a8.632 8.632 0 0 0-5.733 2.661c-.295.309-.537.534-.537.499-.001-.034-.064-.751-.141-1.592-.161-1.741-.302-2.174-.844-2.587-.311-.238-.446-.274-1.117-.303-.63-.026-.829.002-1.142.161-.777.396-.981.914-.864 2.186.044.472.103 1.142.13 1.487l.051.628-.683-.683c-1.416-1.416-3.251-2.255-5.362-2.451l-.666-.062-.738-1.41c-2.178-4.161-3.174-5.38-5.154-6.307-1.09-.51-1.935-.678-3.443-.686-1.828-.01-3.34.312-4.9 1.042a9.268 9.268 0 0 1-1.4.511c-.36.089-.962.307-1.34.485-.377.179-.723.302-.768.274-.045-.028-.469-.557-.943-1.174-.586-.767-.971-1.18-1.211-1.303-.481-.245-1.233-.236-1.713.02';
        
        // Map group names to specific icon SVG paths
        $iconMap = [
            'Fruits & Vegetables' => 'M5.552 4.492c-.866.461-1.259.989-1.259 1.691 0 .528.117.739 1.345 2.441 1.38 1.914 2.031 2.908 2.619 4l.44.817-.441.443c-.57.571-1.258 1.618-1.562 2.377-.488 1.219-.553 1.833-.484 4.552.086 3.344.063 3.438-1.322 5.563-3.071 4.71-3.467 10.38-1.059 15.17 2.11 4.199 5.779 7.017 10.451 8.028 1.317.285 4.424.309 5.74.044 1.2-.242 2.463-.661 3.593-1.194l.98-.462.234.301c.71.915 3.156 2.749 4.598 3.449 1.351.656 2.078.68 5.062.167 1.944-.334 2.488-.327 4.337.057 2.919.605 3.775.501 5.844-.71 2.809-1.644 4.954-3.989 6.433-7.033 1.184-2.436 1.726-4.8 1.726-7.529 0-5.719-2.753-10.986-7.364-14.089-1.117-.752-2.25-1.345-2.748-1.438l-.344-.065.306-.339c1.465-1.622 2.695-4.262 3.013-6.47l.063-.437-.36-.03c-.345-.028-.361-.044-.389-.393l-.03-.364-.904.057a8.632 8.632 0 0 0-5.733 2.661c-.295.309-.537.534-.537.499-.001-.034-.064-.751-.141-1.592-.161-1.741-.302-2.174-.844-2.587-.311-.238-.446-.274-1.117-.303-.63-.026-.829.002-1.142.161-.777.396-.981.914-.864 2.186.044.472.103 1.142.13 1.487l.051.628-.683-.683c-1.416-1.416-3.251-2.255-5.362-2.451l-.666-.062-.738-1.41c-2.178-4.161-3.174-5.38-5.154-6.307-1.09-.51-1.935-.678-3.443-.686-1.828-.01-3.34.312-4.9 1.042a9.268 9.268 0 0 1-1.4.511c-.36.089-.962.307-1.34.485-.377.179-.723.302-.768.274-.045-.028-.469-.557-.943-1.174-.586-.767-.971-1.18-1.211-1.303-.481-.245-1.233-.236-1.713.02',
            'Snack & Munchies' => 'M8.553 3.46a.567.567 0 0 0-.246.502c0 .17.378 1.537.84 3.038.462 1.501.84 2.826.84 2.945 0 .119.042.326.093.461.117.309.417 3.805.607 7.094.472 8.134.292 18.735-.461 27.3l-.119 1.353-.9 2.368c-.495 1.302-.9 2.508-.9 2.68 0 .201.072.38.204.502.204.19.21.19 19.626.19 17.12 0 19.445-.016 19.622-.14.411-.288.367-.515-.623-3.176L46.2 46.06l-.138-1.587c-.508-5.834-.654-9.601-.654-16.846 0-6.477.046-8.021.376-12.694.322-4.556.305-4.454 1.356-7.825.855-2.74.932-3.044.828-3.294-.062-.151-.189-.315-.281-.364-.27-.145-4.672-.111-4.867.037-.238.181-.363.581-.264.844.181.473.381.522 2.135.522 1.259 0 1.613.026 1.579.117-.063.172-.371 1.138-.908 2.847l-.477 1.516H32.574c-8.952 0-12.375.029-12.543.106-.287.13-.462.53-.379.862.14.559-.67.526 12.721.526h12.264l-.059.63a220.588 220.588 0 0 0-.497 6.911c-.197 3.436-.226 14.449-.047 17.799.152 2.853.381 6.408.519 8.055.061.735.093 1.355.07 1.377-.022.023-7.453.041-16.511.041H11.641l.059-.677c.781-8.881.933-20.385.383-28.91-.142-2.204-.287-4.037-.379-4.783l-.055-.443 1.852-.003c1.99-.003 2.088-.025 2.266-.495.117-.308.004-.642-.289-.846-.178-.126-.524-.15-2.137-.15h-1.925L10.72 7.07l-.697-2.263 14.098-.047c7.755-.026 14.167-.08 14.25-.122.176-.088.362-.461.362-.727 0-.102-.103-.289-.229-.415l-.229-.229H8.799l-.246.193',
            'Bakery & Biscuits' => 'M39.615 1.482c-2.408.689-5.92 3.244-11.615 8.45-2.166 1.98-11.172 10.99-13.38 13.386C8.679 29.765 5.119 34.379 3.338 37.94c-1.308 2.616-1.407 3.949-.369 4.983.266.264.589.48.822.55 2.419.718 6.677-1.78 13.242-7.77 3.539-3.228 13.946-13.993 18.728-19.372 6.081-6.838 8.485-10.74 8.015-13.006-.172-.825-.85-1.597-1.659-1.885-.492-.176-1.82-.154-2.502.042',
            'Cold Drinks & Juices' => 'M17.584 4.331c-.159.07-.317.199-.35.286-.033.087-.061 2.877-.061 6.2v6.042l-.536.166c-1.986.614-3.595 2.318-4.193 4.442-.162.576-.171 1.354-.171 15.711v15.105l.262.225.262.225h14.166l.262-.225.262-.225V21.42l-.206-.653a5.763 5.763 0 0 0-3.738-3.747l-.77-.242V4.699l-.24-.226c-.24-.225-.255-.226-2.45-.248-1.712-.018-2.275.006-2.499.106',
            'Dairy, Bread & Eggs' => 'M16.554 2.349c-.376.182-.407.432-.407 3.257v2.703l-3.272 4.671c-1.799 2.569-3.353 4.805-3.453 4.969-.178.292-.181.621-.182 18.059v17.76l.244.245.244.244 18.026-.065 18.026-.065.233-.232.234-.232.051-2.915c.028-1.603.028-9.593 0-17.755l-.051-14.84-3.384-5.093-3.383-5.094v-5.18l-.273-.273-.273-.273-11.09.006c-7.435.005-11.156.038-11.29.103',
            'Chicken, Meat & Fish' => 'M16.342 12.136c-.305.13-.469.365-.472.677-.003.214.283.543 1.616 1.867 1.545 1.532 2.439 2.59 2.985 3.528.137.236.249.475.249.533 0 .058-.472.346-1.05.642-2.358 1.206-4.255 2.774-5.369 4.44-.232.347-.437.63-.456.63-.019 0-2.621-2.18-5.782-4.844-3.161-2.665-5.823-4.865-5.915-4.889-.241-.063-.706.187-.823.443a.766.766 0 0 0-.043.434c.031.118 1.606 2.987 3.5 6.375 3.12 5.581 3.434 6.181 3.341 6.386-.057.125-1.621 2.94-3.476 6.255-2.185 3.906-3.371 6.12-3.371 6.288 0 .341.365.726.688.726.138 0 .372-.094.52-.209.209-.162 10.492-8.805 11.152-9.373.131-.113.191-.06.508.453 1.043 1.69 2.971 3.328 5.46 4.639l1.021.537-.431.646c-.666.998-1.604 2.06-3.026 3.426-1.097 1.053-1.301 1.292-1.298 1.522.003.336.167.562.5.688.331.126 3.662.127 4.923.001 3.735-.371 7.508-1.581 10.049-3.221l.683-.441 1.464.016c4.25.045 8.621-.661 12.126-1.958 3.082-1.141 5.879-2.956 7.46-4.842 1.093-1.304 1.965-3.169 1.807-3.867-.109-.487-.214-.581-1.147-1.03l-.833-.4.639-.255c.736-.294 1.223-.633 1.337-.933.116-.307-.059-1.015-.472-1.905-1.192-2.565-3.822-4.809-7.506-6.403-3.609-1.562-7.478-2.34-12.18-2.449-1.923-.045-2.216-.071-2.38-.217-.427-.379-1.755-1.174-2.828-1.694-1.944-.941-4.542-1.714-7.037-2.094-1.172-.179-5.789-.275-6.133-.128',
            'Baby Care' => 'M6.254 1.513c-.71.273-1.49 1.063-1.759 1.781-.176.471-.202.73-.202 2.047 0 1.345.022 1.551.198 1.916.243.502.77.869 1.341.933l.421.048v1.751c0 2.174-.068 2.433-1.216 4.576-.982 1.833-1.147 2.203-1.473 3.308l-.248.84-.029 15.4c-.022 11.182-.001 15.554.076 15.96.32 1.697 1.702 3.091 3.425 3.457.53.112 2.56.134 12.579.134 7.666.001 12.164-.033 12.553-.094 1.265-.199 2.642-1.189 3.209-2.308.554-1.094.53-.279.503-17.125l-.026-15.424-.211-.746c-.12-.424-.715-1.777-1.375-3.127-.64-1.309-1.205-2.569-1.256-2.8-.051-.231-.094-1.177-.095-2.101l-.002-1.682.468-.166c.611-.217 1.068-.628 1.261-1.131.126-.33.149-.673.123-1.842-.032-1.406-.039-1.449-.34-2.06-.334-.678-.812-1.152-1.505-1.494l-.427-.211-12.74-.019-12.74-.019-.513.198',
        ];
        
        // Check if we have a specific icon for this group, or use default
        $groupNameLower = strtolower($groupName);
        foreach ($iconMap as $key => $path) {
            if (strtolower($key) === $groupNameLower || 
                strpos($groupNameLower, strtolower($key)) !== false) {
                return $path;
            }
        }
        
        return $defaultIcon;
    }

    #[On('authenticated')]
    public function refresh()
    {
        $this->account = auth()->check();
    }

    public function render()
    {
        return view('livewire.layouts.customer.header.menus');
    }
}
